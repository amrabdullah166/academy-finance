# ุฏููู ุฅุนุฏุงุฏ ูุธุงู ุงูุฑุณูู

## ุงูุฎุทูุงุช ุงููุทููุจุฉ ูุชูุนูู ูุธุงู ุงูุฑุณูู

### 1. ุชุทุจูู Schema ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

ูู ุจุชูููุฐ ููู `database/fees-system.sql` ุนูู ูุงุนุฏุฉ ุจูุงูุงุช Supabase:

1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู SQL Editor
3. ุงูุณุฎ ูุญุชูู ููู `database/fees-system.sql`
4. ูู ุจุชูููุฐ ุงูุฃูุงูุฑ

ุฃู ุงุณุชุฎุฏู ูุฐุง ุงูุฃูุฑ ุฅุฐุง ูุงู ูุฏูู Supabase CLI:
```bash
supabase db push
```

### 2. ุงูุชุญุฏูุซุงุช ุงูุชู ุชูุช

#### ุตูุญุฉ ุงูููุฑุณุงุช (`src/app/courses/page.tsx`)
- โ ุฅุถุงูุฉ ุญูู ุฑุณูู ุงูุชุณุฌูู (registration_fee)
- โ ุฅุถุงูุฉ ุญูู ุฑุณูู ุงูููุงุตูุงุช (transportation_fee)
- โ ุชุญุฏูุซ ูููุฐุฌ ุฅุถุงูุฉ/ุชุนุฏูู ุงูููุฑุณ
- โ ุฅุถุงูุฉ ุฃุนูุฏุฉ ุงูุฑุณูู ูู ุฌุฏูู ุงูููุฑุณุงุช

#### ุตูุญุฉ ุงูุชุณุฌูู (`src/app/enrollments/page.tsx`)
- โ ุฅุถุงูุฉ ุฎูุงุฑ ุงูููุงุตูุงุช (checkbox)
- โ ุนุฑุถ ุฑุณูู ุงูููุงุตูุงุช ูู ูุงุฆูุฉ ุงูููุฑุณุงุช
- โ ุญุณุงุจ ุงูุฑุณูู ุงูุฅุฌูุงููุฉ ุนูุฏ ุงูุชุณุฌูู

#### ููุชุจุฉ Supabase (`src/lib/supabase.ts`)
- โ ุชุญุฏูุซ ุฏุงูุฉ `enrollStudentInCourse` ูุชูุจู ูุนุงูู ุงูููุงุตูุงุช
- โ ุญุณุงุจ ุงูุฑุณูู ุงูุดูุฑูุฉ ุชููุงุฆูุงู (ุฑุณูู ุงูููุฑุณ + ุฑุณูู ุงูููุงุตูุงุช)
- โ ุญูุธ ูุนูููุงุช ุฑุณูู ุงูุชุณุฌูู

#### ูุงุนุฏุฉ ุงูุจูุงูุงุช (`database/fees-system.sql`)
- โ ุฅุถุงูุฉ ุฃุนูุฏุฉ ุงูุฑุณูู ูุฌุฏูู courses
- โ ุฅุถุงูุฉ ุฃุนูุฏุฉ ุชุชุจุน ุงูุฑุณูู ูุฌุฏูู student_courses
- โ ุฅูุดุงุก ุฌุฏูู monthly_payments ูููุฏููุนุงุช ุงูุดูุฑูุฉ
- โ ุฅุถุงูุฉ triggers ูุฅูุดุงุก ุงููุฏููุนุงุช ุงูุดูุฑูุฉ ุชููุงุฆูุงู
- โ ุฅุถุงูุฉ RLS policies ููุฃูุงู

### 3. ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

#### ุฃููุงุน ุงูุฑุณูู
1. **ุฑุณูู ุงูุชุณุฌูู (Registration Fee)**:
   - ุชุฏูุน ูุฑุฉ ูุงุญุฏุฉ ุนูุฏ ุงูุชุณุฌูู
   - ุงุฎุชูุงุฑูุฉ (ูููู ุฃู ุชููู ุตูุฑ)
   - ุชูุญูุธ ูู ุฌุฏูู student_courses

2. **ุงูุฑุณูู ุงูุดูุฑูุฉ (Monthly Fee)**:
   - ุชุฏูุน ุดูุฑูุงู
   - ุฅูุฒุงููุฉ ููู ููุฑุณ
   - ูุชู ุฅูุดุงุก 12 ุณุฌู ุฏูุน ุชููุงุฆูุงู ุนูุฏ ุงูุชุณุฌูู

3. **ุฑุณูู ุงูููุงุตูุงุช (Transportation Fee)**:
   - ุงุฎุชูุงุฑูุฉ (ูุฎุชุงุฑูุง ุงูุทุงูุจ ุนูุฏ ุงูุชุณุฌูู)
   - ุชูุถุงู ููุฑุณูู ุงูุดูุฑูุฉ ุฅุฐุง ุชู ุงุฎุชูุงุฑูุง
   - ุชุธูุฑ ูููุตูุฉ ูู ุงูุชูุงุฑูุฑ

#### ุงูุชุชุจุน ุงูุชููุงุฆู
- **Trigger**: ุนูุฏ ุชุณุฌูู ุทุงูุจ ุฌุฏูุฏุ ูุชู ุฅูุดุงุก 12 ุณุฌู ุฏูุน ุดูุฑู ุชููุงุฆูุงู
- **ุญุงูุฉ ุงูุฏูุน**: ุชุชุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ ุฏูุนุฉ ูู ุฌุฏูู payments
- **ุงูููุชุฑุฉ**: ูููู ุนุฑุถ ุงููุฏููุนุงุช ุงููุณุชุญูุฉ/ุงููุฏููุนุฉ/ุงููุชุฃุฎุฑุฉ

### 4. ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

#### ุตูุญุฉ ุงููุฏููุนุงุช ุงูุดูุฑูุฉ (ุงุฎุชูุงุฑู)
ุฅูุดุงุก ุตูุญุฉ ุฌุฏูุฏุฉ ูุนุฑุถ ุงููุฏููุนุงุช ุงูุดูุฑูุฉ:
- ุนุฑุถ ุฌููุน ุงููุฏููุนุงุช ุงููุณุชุญูุฉ
- ููุชุฑุฉ ุญุณุจ ุงูุญุงูุฉ (ูุฏููุน/ุบูุฑ ูุฏููุน/ูุชุฃุฎุฑ)
- ุฅููุงููุฉ ุชุณุฌูู ุฏูุนุฉ ูุจุงุดุฑุฉ
- ุชูุงุฑูุฑ ุจุงููุฏููุนุงุช ุงูุดูุฑูุฉ

#### ุชุญุณููุงุช ุตูุญุฉ ุงููุฏููุนุงุช
- ุนุฑุถ ุฑุณูู ุงูุชุณุฌูู ูููุตูุฉ
- ุชูููุฒ ุงููุฏููุนุงุช ุงูุดูุฑูุฉ
- ุฅุธูุงุฑ ุงููุฏููุนุงุช ุงููุชุฃุฎุฑุฉ

#### ุชูุงุฑูุฑ ูุงููุฉ ูุญุณููุฉ
- ุชูุฑูุฑ ุงูุฅูุฑุงุฏุงุช ุญุณุจ ููุน ุงูุฑุณูู
- ุชูุฑูุฑ ุงููุฏููุนุงุช ุงููุณุชุญูุฉ
- ุชูุฑูุฑ ุงููุฏููุนุงุช ุงููุชุฃุฎุฑุฉ

### 5. ููููุฉ ุงูุงุณุชุฎุฏุงู

#### ุฅุถุงูุฉ ููุฑุณ ุฌุฏูุฏ
1. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูููุฑุณุงุช
2. ุงุถุบุท "ุฅุถุงูุฉ ููุฑุณ ุฌุฏูุฏ"
3. ุฃุฏุฎู:
   - ุงุณู ุงูููุฑุณ
   - ุงูุฑุณูู ุงูุดูุฑูุฉ (ุฅูุฒุงูู)
   - ุฑุณูู ุงูุชุณุฌูู (ุงุฎุชูุงุฑู)
   - ุฑุณูู ุงูููุงุตูุงุช (ุงุฎุชูุงุฑู)
4. ุงุญูุธ

#### ุชุณุฌูู ุทุงูุจ ูู ููุฑุณ
1. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุชุณุฌูู
2. ุงุฎุชุฑ ุงูุทุงูุจ
3. ุงุฎุชุฑ ุงูููุฑุณ
4. ุฅุฐุง ูุงู ุงูููุฑุณ ูููุฑ ููุงุตูุงุชุ ุณูุธูุฑ ุฎูุงุฑ "ุฅุถุงูุฉ ุฎุฏูุฉ ุงูููุงุตูุงุช"
5. ุงุถุบุท "ุชุณุฌูู ุงูุทุงูุจ"
6. ุณูุชู ุชููุงุฆูุงู:
   - ุญุณุงุจ ุงูุฑุณูู ุงูุดูุฑูุฉ (ูุน ุฃู ุจุฏูู ููุงุตูุงุช)
   - ุญูุธ ุฑุณูู ุงูุชุณุฌูู
   - ุฅูุดุงุก 12 ุณุฌู ุฏูุน ุดูุฑู

#### ุชุชุจุน ุงููุฏููุนุงุช
- ุงููุฏููุนุงุช ุงูุดูุฑูุฉ ุชูุญุฏูุซ ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ ุฏูุนุฉ
- ููููู ุนุฑุถ ุญุงูุฉ ูู ุดูุฑ (ูุฏููุน/ุบูุฑ ูุฏููุน)
- ุงููุฏููุนุงุช ุงููุชุฃุฎุฑุฉ ุชุธูุฑ ุจููู ูููุฒ

### 6. ููุงุญุธุงุช ูููุฉ

โ๏ธ **ูุจู ุงูุชุทุจูู ุนูู Production**:
- ุชุฃูุฏ ูู ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงุฎุชุจุฑ ุงููุธุงู ุนูู ุจูุฆุฉ ุชุทููุฑ ุฃููุงู
- ุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏููู (RLS policies)

๐ **ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ**:
- ุงูููุฑุณุงุช ุงูุญุงููุฉ ุณุชุญุตู ุนูู ููู ุงูุชุฑุงุถูุฉ (0) ููุฑุณูู ุงูุฌุฏูุฏุฉ
- ุงูุชุณุฌููุงุช ุงูุญุงููุฉ ุณุชุญุชุงุฌ ูุชุญุฏูุซ ูุฏูู ุฅุฐุง ุฃุฑุฏุช ุฅุถุงูุฉ ุงููุฏููุนุงุช ุงูุดูุฑูุฉ ููุง
- ููููู ุชุนุฏูู ุงูููุฑุณุงุช ูุฅุถุงูุฉ ุงูุฑุณูู

๐ **ุงูุฃูุงู**:
- ุฌููุน ุงูุฌุฏุงูู ูุญููุฉ ุจู RLS policies
- ุงููุณุชุฎุฏููู ุงููุตุฑุญ ููู ููุท ูููููู ุงููุฑุงุกุฉ/ุงููุชุงุจุฉ
- Triggers ูุญููุฉ ููุง ูููู ุชุนุฏูููุง ูุจุงุดุฑุฉ

### 7. ุงุณุชุนูุงูุงุช ูููุฏุฉ

#### ุนุฑุถ ุงููุฏููุนุงุช ุงููุณุชุญูุฉ ูุฐุง ุงูุดูุฑ
```sql
SELECT 
  s.name as student_name,
  c.name as course_name,
  mp.month,
  mp.amount,
  mp.status
FROM monthly_payments mp
JOIN student_courses sc ON mp.enrollment_id = sc.id
JOIN students s ON sc.student_id = s.id
JOIN courses c ON sc.course_id = c.id
WHERE mp.month = EXTRACT(MONTH FROM CURRENT_DATE)
  AND mp.year = EXTRACT(YEAR FROM CURRENT_DATE)
  AND mp.status = 'unpaid'
ORDER BY s.name;
```

#### ุฅุญุตุงุฆูุงุช ุงูุฑุณูู ูููุฑุณ ูุนูู
```sql
SELECT 
  c.name,
  COUNT(sc.id) as total_students,
  SUM(CASE WHEN sc.registration_fee_paid THEN sc.registration_fee ELSE 0 END) as registration_revenue,
  SUM(mp.amount) FILTER (WHERE mp.status = 'paid') as monthly_revenue,
  COUNT(*) FILTER (WHERE sc.has_transportation) as students_with_transportation
FROM courses c
LEFT JOIN student_courses sc ON c.id = sc.course_id
LEFT JOIN monthly_payments mp ON sc.id = mp.enrollment_id
WHERE c.id = 'YOUR_COURSE_ID'
GROUP BY c.id, c.name;
```

## ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู console.log ูู ุงููุชุตูุญ
2. ุชุญูู ูู Supabase logs
3. ุชุฃูุฏ ูู ุชุทุจูู ุฌููุน ุงูุฃูุงูุฑ SQL ุจูุฌุงุญ
