# โ ูุธุงู ุงูุฑุณูู - ุชู ุงูุชูููุฐ ุจูุฌุงุญ

## ๐ ููุฎุต ุงูุชุญุฏูุซุงุช

### 1๏ธโฃ ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database)
**ุงูููู**: `database/fees-system.sql`

#### ุงูุชุนุฏููุงุช ุนูู ุฌุฏูู `courses`:
- โ `registration_fee` - ุฑุณูู ุงูุชุณุฌูู (ูุฑุฉ ูุงุญุฏุฉ)
- โ `monthly_fee` - ุงูุฑุณูู ุงูุดูุฑูุฉ (ููุฌูุฏุฉ ูุณุจูุงู)
- โ `transportation_fee` - ุฑุณูู ุงูููุงุตูุงุช (ุดูุฑูุงู)

#### ุงูุชุนุฏููุงุช ุนูู ุฌุฏูู `student_courses`:
- โ `registration_fee` - ุฑุณูู ุงูุชุณุฌูู ููุฐุง ุงูุทุงูุจ
- โ `registration_fee_paid` - ูู ุชู ุฏูุน ุฑุณูู ุงูุชุณุฌููุ
- โ `monthly_fee` - ุงูุฑุณูู ุงูุดูุฑูุฉ (ููุฑุณ + ููุงุตูุงุช)
- โ `has_transportation` - ูู ุงูุทุงูุจ ูุดุชุฑู ุจุงูููุงุตูุงุชุ
- โ `transportation_fee` - ูููุฉ ุฑุณูู ุงูููุงุตูุงุช

#### ุฌุฏูู ุฌุฏูุฏ `monthly_payments`:
```sql
- id (UUID)
- enrollment_id (FK โ student_courses)
- month (1-12)
- year (2024, 2025, ...)
- amount (ุงููุจูุบ ุงููุทููุจ)
- status (paid/unpaid/overdue)
- paid_date (ุชุงุฑูุฎ ุงูุฏูุน)
- due_date (ุชุงุฑูุฎ ุงูุงุณุชุญูุงู)
```

#### Triggers ุชููุงุฆูุฉ:
1. **create_monthly_payments_for_enrollment**:
   - ูุชู ุชูุนููู ุนูุฏ: ุชุณุฌูู ุทุงูุจ ุฌุฏูุฏ ูู ููุฑุณ
   - ุงูุฅุฌุฑุงุก: ุฅูุดุงุก 12 ุณุฌู ุฏูุน ุดูุฑู ุชููุงุฆูุงู

2. **update_monthly_payment_status**:
   - ูุชู ุชูุนููู ุนูุฏ: ุฅุถุงูุฉ ุฏูุนุฉ ูู ุฌุฏูู payments
   - ุงูุฅุฌุฑุงุก: ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูุนุฉ ุงูุดูุฑูุฉ ุฅูู "paid"

---

### 2๏ธโฃ ูุงุฌูุฉ ุงูููุฑุณุงุช
**ุงูููู**: `src/app/courses/page.tsx`

#### ูููุฐุฌ ุฅุถุงูุฉ/ุชุนุฏูู ููุฑุณ:
```tsx
<Input label="ุฑุณูู ุงูุชุณุฌูู" type="number" />
<Input label="ุงูุฑุณูู ุงูุดูุฑูุฉ" type="number" required />
<Input label="ุฑุณูู ุงูููุงุตูุงุช (ุดูุฑูุงู)" type="number" />
```

#### ุฌุฏูู ุงูููุฑุณุงุช:
| ุงุณู ุงูููุฑุณ | ุฑุณูู ุดูุฑูุฉ | ุฑุณูู ุชุณุฌูู | ุฑุณูู ููุงุตูุงุช | ... |
|------------|-----------|-----------|-------------|-----|

---

### 3๏ธโฃ ูุงุฌูุฉ ุงูุชุณุฌูู
**ุงูููู**: `src/app/enrollments/page.tsx`

#### ูููุฐุฌ ุชุณุฌูู ุทุงูุจ:
1. ุงุฎุชุฑ ุงูุทุงูุจ
2. ุงุฎุชุฑ ุงูููุฑุณ
3. **[ุฌุฏูุฏ]** โ๏ธ ุฅุถุงูุฉ ุฎุฏูุฉ ุงูููุงุตูุงุช (ูุธูุฑ ููุท ููููุฑุณุงุช ุงูุชู ูููุง ุฑุณูู ููุงุตูุงุช)

#### ูุซุงู:
```
ุงูููุฑุณ: ุจุฑูุฌุฉ - 50 ุฏููุงุฑ ุดูุฑูุงู (ููุงุตูุงุช: 15 ุฏ)
โ๏ธ ุฅุถุงูุฉ ุฎุฏูุฉ ุงูููุงุตูุงุช (15 ุฏููุงุฑ ุดูุฑูุงู)
โ ุงูุฅุฌูุงูู ุงูุดูุฑู: 65 ุฏููุงุฑ
```

---

### 4๏ธโฃ ููุชุจุฉ Supabase
**ุงูููู**: `src/lib/supabase.ts`

#### ุฏูุงู ูุญุฏูุซุฉ:
```typescript
// ุชุญุฏูุซ: ุชูุจู ูุนุงูู ุงูููุงุตูุงุช
enrollStudentInCourse(studentId, courseId, hasTransportation)

// ุฌุฏูุฏ: ุงูุญุตูู ุนูู ุงููุฏููุนุงุช ุงูุดูุฑูุฉ
getMonthlyPayments(filters?)

// ุฌุฏูุฏ: ุฅุญุตุงุฆูุงุช ุงููุฏููุนุงุช
getMonthlyPaymentsSummary(month, year)

// ุฌุฏูุฏ: ุชุญุฏูุฏ ุฏูุนุฉ ููุฏููุนุฉ
markMonthlyPaymentAsPaid(paymentId)

// ุฌุฏูุฏ: ุณุฌู ุฏูุนุงุช ุงูุทุงูุจ
getStudentPaymentHistory(studentId)
```

---

## ๐ ุงูุฎุทูุฉ ุงููุญูุฏุฉ ุงููุทููุจุฉ

### ุชุทุจูู SQL ุนูู Supabase:

1. ุงูุชุญ **Supabase Dashboard**: https://app.supabase.com
2. ุงุฐูุจ ุฅูู **SQL Editor**
3. ุงูุณุฎ ูุญุชูู ููู `database/fees-system.sql`
4. ุงูุตู ูู ุงููุญุฑุฑ
5. ุงุถุบุท **Run** ุฃู **Execute**

โ ุงูุชูู!

---

## ๐ก ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุณููุงุฑูู 1: ุฅุถุงูุฉ ููุฑุณ ุฌุฏูุฏ ุจุฌููุน ุฃููุงุน ุงูุฑุณูู
```
ุงูุฎุทูุงุช:
1. ุตูุญุฉ ุงูููุฑุณุงุช โ "ุฅุถุงูุฉ ููุฑุณ ุฌุฏูุฏ"
2. ุฃุฏุฎู ุงูุจูุงูุงุช:
   - ุงุณู ุงูููุฑุณ: "ุจุฑูุฌุฉ ูุชูุฏูุฉ"
   - ุงูุฑุณูู ุงูุดูุฑูุฉ: 50 ุฏููุงุฑ โ (ุฅูุฒุงูู)
   - ุฑุณูู ุงูุชุณุฌูู: 20 ุฏููุงุฑ (ุงุฎุชูุงุฑู)
   - ุฑุณูู ุงูููุงุตูุงุช: 15 ุฏููุงุฑ (ุงุฎุชูุงุฑู)
3. ุงุญูุธ

ุงููุชูุฌุฉ:
โ ุงูููุฑุณ ุฌุงูุฒ ุจุฌููุน ุฃููุงุน ุงูุฑุณูู
```

### ุณููุงุฑูู 2: ุชุณุฌูู ุทุงูุจ ูุน ููุงุตูุงุช
```
ุงูุฎุทูุงุช:
1. ุตูุญุฉ ุงูุชุณุฌูู โ "ุชุณุฌูู ุทุงูุจ ูู ุฏูุฑุฉ"
2. ุงุฎุชุฑ ุงูุทุงูุจ: "ุฃุญูุฏ ูุญูุฏ"
3. ุงุฎุชุฑ ุงูููุฑุณ: "ุจุฑูุฌุฉ ูุชูุฏูุฉ"
4. โ๏ธ ุฅุถุงูุฉ ุฎุฏูุฉ ุงูููุงุตูุงุช (15 ุฏููุงุฑ ุดูุฑูุงู)
5. ุชุณุฌูู ุงูุทุงูุจ

ูุงุฐุง ูุญุฏุซ ุชููุงุฆูุงูุ
1. ููุญุณุจ ุงูุฅุฌูุงูู ุงูุดูุฑู: 50 + 15 = 65 ุฏููุงุฑ
2. ุชูุญูุธ ุฑุณูู ุงูุชุณุฌูู: 20 ุฏููุงุฑ (ุบูุฑ ูุฏููุนุฉ)
3. ูุชู ุฅูุดุงุก 12 ุณุฌู ุฏูุน ุดูุฑู:
   - ููุงูุฑ 2024: 65 ุฏููุงุฑ (unpaid)
   - ูุจุฑุงูุฑ 2024: 65 ุฏููุงุฑ (unpaid)
   - ูุงุฑุณ 2024: 65 ุฏููุงุฑ (unpaid)
   ... ุฅูุฎ
```

### ุณููุงุฑูู 3: ุชุณุฌูู ุทุงูุจ ุจุฏูู ููุงุตูุงุช
```
ุงูุฎุทูุงุช:
1-3. ููุณ ุงูุฎุทูุงุช ุงูุณุงุจูุฉ
4. โฌ ูุง ุชุถุน ุนูุงูุฉ ุนูู ุงูููุงุตูุงุช
5. ุชุณุฌูู ุงูุทุงูุจ

ุงููุชูุฌุฉ:
- ุงูุฅุฌูุงูู ุงูุดูุฑู: 50 ุฏููุงุฑ ููุท
- ุฑุณูู ุงูุชุณุฌูู: 20 ุฏููุงุฑ
- 12 ุณุฌู ุฏูุน ุดูุฑู ุจู 50 ุฏููุงุฑ ููู ูููุง
```

---

## ๐ ุงูููุฒุงุช ุงูุชููุงุฆูุฉ

### 1. ุฅูุดุงุก ุงููุฏููุนุงุช ุงูุดูุฑูุฉ
```
ุนูุฏ ุชุณุฌูู ุทุงูุจ โ ุชููุงุฆูุงู:
โ ุฅูุดุงุก 12 ุณุฌู ุฏูุน (ููุงูุฑ - ุฏูุณูุจุฑ)
โ ุญุณุงุจ ุงููุจูุบ ุงูุตุญูุญ (ูุน ุฃู ุจุฏูู ููุงุตูุงุช)
โ ุชุญุฏูุฏ ุชุงุฑูุฎ ุงูุงุณุชุญูุงู ููู ุดูุฑ
โ ุงูุญุงูุฉ ุงูุฃูููุฉ: "unpaid"
```

### 2. ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูุน
```
ุนูุฏ ุฅุถุงูุฉ ุฏูุนุฉ ูู ุฌุฏูู payments โ ุชููุงุฆูุงู:
โ ุงูุจุญุซ ุนู ุงูุฏูุนุฉ ุงูุดูุฑูุฉ ุงููุทุงุจูุฉ
โ ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู "paid"
โ ุญูุธ ุชุงุฑูุฎ ุงูุฏูุน
```

### 3. ุชุญุฏูุฏ ุงููุฏููุนุงุช ุงููุชุฃุฎุฑุฉ
```
ููููู ูุงุญูุงู ุฅุถุงูุฉ:
- Cron job ูููู ูุญุฏูุซ ุงูุฏูุนุงุช ุงููุชุฃุฎุฑุฉ
- ุฃู ุงุณุชุนูุงู SQL:
  UPDATE monthly_payments
  SET status = 'overdue'
  WHERE status = 'unpaid'
    AND due_date < CURRENT_DATE;
```

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

### ุฅูุดุงุก ุตูุญุฉ ุงููุฏููุนุงุช ุงูุดูุฑูุฉ
ุตูุญุฉ ุฌุฏูุฏุฉ ุชุนุฑุถ:
- โ ุฌููุน ุงููุฏููุนุงุช ุงููุณุชุญูุฉ ูุฐุง ุงูุดูุฑ
- โ ููุชุฑุฉ: ูุฏููุน / ุบูุฑ ูุฏููุน / ูุชุฃุฎุฑ
- โ ุฅุญุตุงุฆูุงุช: ูุณุจุฉ ุงูุชุญุตููุ ุงููุจุงูุบ ุงููุชุฃุฎุฑุฉ
- โ ุฅููุงููุฉ ุชุณุฌูู ุฏูุนุฉ ูุจุงุดุฑุฉ

### ุชุญุณูู ุตูุญุฉ ุงููุฏููุนุงุช
- ุนุฑุถ ุฑุณูู ุงูุชุณุฌูู ูููุตูุฉ
- ุชูููุฒ ุงููุฏููุนุงุช ุงูุดูุฑูุฉ ุนู ุงูุฏูุนุงุช ุงูุฃุฎุฑู
- ุฅุธูุงุฑ ุญุงูุฉ ูู ุดูุฑ (ูุฏููุน/ุบูุฑ ูุฏููุน)

### ุชูุงุฑูุฑ ูุงููุฉ
- ุชูุฑูุฑ ุงูุฅูุฑุงุฏุงุช ุญุณุจ ููุน ุงูุฑุณูู
- ุชูุฑูุฑ ุงููุฏููุนุงุช ุงููุชุฃุฎุฑุฉ
- ุชุญููู ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ

---

## ๐ ุงุณุชุนูุงูุงุช SQL ูููุฏุฉ

### ุงููุฏููุนุงุช ุงููุณุชุญูุฉ ูุฐุง ุงูุดูุฑ
```sql
SELECT 
  s.name as student_name,
  c.name as course_name,
  mp.amount,
  mp.status,
  mp.due_date
FROM monthly_payments mp
JOIN student_courses sc ON mp.enrollment_id = sc.id
JOIN students s ON sc.student_id = s.id
JOIN courses c ON sc.course_id = c.id
WHERE mp.month = EXTRACT(MONTH FROM CURRENT_DATE)
  AND mp.year = EXTRACT(YEAR FROM CURRENT_DATE)
ORDER BY mp.due_date;
```

### ุฅุญุตุงุฆูุงุช ุงูุฑุณูู ููู ููุฑุณ
```sql
SELECT 
  c.name as course_name,
  COUNT(sc.id) as total_students,
  SUM(sc.registration_fee) as total_registration_fees,
  SUM(sc.monthly_fee) as monthly_revenue_potential,
  COUNT(*) FILTER (WHERE sc.has_transportation) as students_with_transport
FROM courses c
LEFT JOIN student_courses sc ON c.id = sc.course_id
GROUP BY c.id, c.name;
```

### ุงูุทูุงุจ ุงูุฐูู ูุฏููู ูุฏููุนุงุช ูุชุฃุฎุฑุฉ
```sql
SELECT DISTINCT
  s.name,
  s.phone,
  COUNT(*) as overdue_count,
  SUM(mp.amount) as total_overdue
FROM monthly_payments mp
JOIN student_courses sc ON mp.enrollment_id = sc.id
JOIN students s ON sc.student_id = s.id
WHERE mp.status = 'overdue'
GROUP BY s.id, s.name, s.phone
ORDER BY total_overdue DESC;
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### ูุจู ุงูุชุทุจูู ุนูู Production:
- โ ุงุญูุธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงุฎุชุจุฑ ุนูู ุจูุฆุฉ ุชุทููุฑ ุฃููุงู
- โ ุชุญูู ูู RLS policies

### ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ:
- ุงูููุฑุณุงุช ุงููุฏููุฉ โ ุฑุณูู ุฌุฏูุฏุฉ = 0 (ููููู ุชุญุฏูุซูุง)
- ุงูุชุณุฌููุงุช ุงููุฏููุฉ โ ูู ุชุญุตู ุนูู ูุฏููุนุงุช ุดูุฑูุฉ ุชููุงุฆูุงู
  - ููููู ุชุดุบูู ุงูู trigger ูุฏููุงู ุฅุฐุง ุฃุฑุฏุช

### ุงูุฃูุงู:
- โ ุฌููุน ุงูุฌุฏุงูู ูุญููุฉ ุจู RLS
- โ Triggers ูุง ูููู ุชุนุฏูููุง ูู ุงููุณุชุฎุฏููู
- โ Policies ุชุณูุญ ููุท ุจุงูุนูููุงุช ุงููุตุฑุญ ุจูุง

---

## ๐ ุชู!

ุงููุธุงู ุฌุงูุฒ ุชูุงูุงู. ููุท ูููุฐ ููู SQL ุนูู Supabase ูุงุจุฏุฃ ุงูุงุณุชุฎุฏุงู!

### ุงูุฏุนู
ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุชุญูู ูู **Console** ูู ุงููุชุตูุญ (F12)
2. ุชุญูู ูู **Supabase Logs**
3. ุชุฃูุฏ ูู ุชุทุจูู SQL ุจุงููุงูู ุจูุฌุงุญ

---

๐ **ุงููููุงุช ุฐุงุช ุงูุตูุฉ:**
- `database/fees-system.sql` - Schema ุงููุงูู
- `FEE_SYSTEM_SETUP.md` - ุฏููู ุชูุตููู
- `QUICK_START_FEES.md` - ุฏููู ุณุฑูุน
